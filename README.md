# Laravel Simple Extendables

## About

A simple and opinionated library contains base classes, interfaces, traits, and templates for building APIs using Laravel

## Inspiration

- [Laravel beyond CRUD: Domain oriented Laravel](https://online.fliphtml5.com/pbudi/dfap/#p=6)
- [Laravel beyond CRUD: Working with data](https://online.fliphtml5.com/pbudi/dfap/#p=6)
- [Laravel beyond CRUD: Actions](https://online.fliphtml5.com/pbudi/dfap/#p=6)
- [Laravel beyond CRUD: Models](https://online.fliphtml5.com/pbudi/dfap/#p=6)
- [Laravel beyond CRUD: Testing domains](https://online.fliphtml5.com/pbudi/dfap/#p=7)
- [Effective Eloquent queries](https://laravel-news.com/effective-eloquent)
- [JSON API specification's query string format](https://jsonapi.org/format/#fetching)
- [State machines in Laravel](https://www.youtube.com/watch?v=1A1xFtlDyzU)

## System requirement

PHP 8.2 or above

## Installation

### For Laravel < 11:

- Copy all the library's files (or just the files you need from the library) and put them in `app/Extendables` directory
- Add the library's service provider in the `config/app.php` file

```php
'providers' => [
    ...
    \App\Extendables\Providers\ExtendableServiceProvider::class,
];
```

### For Laravel >= 11:

- Copy all the library's files (or just the files you need from the library) and put them in `app/Extendables` directory
- Add the library's service provider in the `bootstrap/providers.php` file

```php
return [
    ...
    \App\Extendables\Providers\ExtendableServiceProvider::class,
];
```

## Structure

- Core/
    - Cache/
        - CacheHelper.php: helper class to interact with cache storage
        - RedisCacheHelper.php: helper class to interact with Redis cache storage
    - Http/
        - Controllers/: controller templates
        - Enums/: HTTP related enum templates
        - Exception/
            - Handler.php: customized exception handler
        - Middleware/: middleware templates
        - Request/
            - States/: manage request data and information
                - QueryString/: states from query string
                    - JsonApi/: query string state following the JSON API specification's query string format
                    - FilterQueryStringState.php: filter query string state
                    - FilterCondition.php: represent a filter condition (field:value) of the query string
                    - OnlyQueryStringState.php: only query string state
                    - PaginateQueryStringState.php: pagination query string state
                    - RelationQueryStringState.php: relationship query string state
                    - SortQueryStringState.php: sort query string state
                    - SortCondition.php: represent a sort condition (field:sort direction) of the query string
        - Resource/: base API resource classes for transforming data for JSON responses
        - Response
            - ResponseBuilder.php: build responses following a format
            - Responder.php: utilize ResponseBuilder to create responses for better code reuse
        - Route
            - RouteInvoker.php: helper class to create modular routing definition
        - RouteDocumentation/: attributes to document triggering route in controllers
    - Models/
        - Queries/
            - Filters/: base filter classes
            - Sorts/: base sort classes
            - CountQuery.php: executes count on a query
            - IndexQuery.php: applies filters and sorts to a query based on the query string state
            - PaginateQuery.php: executes pagination on a query based on the query string state
        - Traits/: reusable model traits
    - Ports/: external or third party services interaction
        - File/
        - Mail/
        - Notification/
    - Utils/
        - Base64Handling/: handling of base64 content sent through HTTP request
        - FileHandling/: handling of basic text file
        - Enum.php: reusable enums
        - ValueObject.php: used to structure data instead of using unstructured and hard to predict arrays
- Providers/
    - ExtendableServiceProvider.php: the library service provider
- Templates/
    - Lang/
        - validation.php: validation error code template
    - Readme/
        - README.md: readme template

## Configuration

### Filesystem

You can set the following configuration keys to config the `FileStorageService` provided
by the library:

- `filesystems.temp_url_duration` to config the duration of files' temporary urls generated by the service
- `filesystems.root_dir` to config the storage root directory used by the service
- `filesystems.disks.s3.cloudfront_key_pair_id` to provide the service with the CloudFront key pair id when serving
  assets through CloudFront
- `filesystems.disks.s3.cloudfront_private_key` to provide the service with the base path to the CloudFront private key
  when serving assets through CloudFront

### Exception handler

#### For Laravel < 11:

To use the library's exception handler you need to replace the default import in `app/Exceptions/Handler.php`:

```php
use Illuminate\Foundation\Exceptions\Handler as ExceptionHandler;
```

With the library's handler class:

```php
use App\Extendables\Core\Http\Exception\FluggFormatClassicExceptionHandler as ExceptionHandler;
```

#### For Laravel >= 11:

To use the library's exception handler, update the configuration in `bootstrap/app.php` to use the library exception
handler:

```php
return Application::configure(basePath: dirname(__DIR__))
    ...
    ->withExceptions(new FluggFormatExceptionHandler())
    ...
    ->create();
```

### Auto add accept application/json header for incoming requests

Add the following middleware to the global middleware stack of your Laravel application
```php
\App\Extendables\Core\Http\Middleware\EnsureRequestWantJsonMiddleware::class
```

## Macros

Macros are registered in `ExtendableServiceProvider.php`

### Query builder macros

- whereEmpty
- whereNotEmpty

### Str macros

- replaceSlash
- hashSha256
- hashEachByteSha256

